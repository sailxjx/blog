<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: git | CodeBean]]></title>
  <link href="http://sailxjx.github.io/blog/blog/categories/git/atom.xml" rel="self"/>
  <link href="http://sailxjx.github.io/blog/"/>
  <updated>2013-07-12T16:36:02+08:00</updated>
  <id>http://sailxjx.github.io/blog/</id>
  <author>
    <name><![CDATA[tristan]]></name>
    <email><![CDATA[sailxjx@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[gitlabhq 部署小记]]></title>
    <link href="http://sailxjx.github.io/blog/blog/2012/11/14/gitlabhq-bu-shu-xiao-ji/"/>
    <updated>2012-11-14T20:12:00+08:00</updated>
    <id>http://sailxjx.github.io/blog/blog/2012/11/14/gitlabhq-bu-shu-xiao-ji</id>
    <content type="html"><![CDATA[<p>冬天来了，不知github是不是也去冬眠了，速度慢的像在爬，没办法，屌丝买不起vps，只能自己内网部一套开源的。</p>

<p>gitlabhq是github的一个开源版本，虽然不是官方的，但是已经做的有模有样，总之能想到的功能都已具备，放在国内随便改改UI就能上线建站的那种。安装文档那是写的相当滴详细，体现了码农罕有的耐性，查看文档请移步<a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">gitlab文档</a></p>

<p>以前部署中在ssh上碰到一些问题，这次在<a href="https://github.com/mk-qi">@mk-qi</a>童鞋的点拨下，进展是相当滴顺利，下面记录一些部署过程中的问题和解决方法。</p>

<p>自动部署脚本如下，基本由文档转成，可以省掉很多事情(但是遇到问题要学会google哦)，假如使用的是ubuntu，官方以前也提供了一个一键安装脚本，后来不知怎么又去掉了，估计是计划赶不上变化吧</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>gitlabhq自动化部署脚本  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># add user git</span>
</span><span class='line'>sudo adduser –system –shell /bin/bash –gecos ‘git version control’ –group –disabled-password –home /home/git git
</span><span class='line'><span class="c"># add user gitlab</span>
</span><span class='line'>sudo adduser –disabled-login –gecos ‘gitlab system’ gitlab
</span><span class='line'><span class="c"># move user gitlab to group git</span>
</span><span class='line'>sudo usermod -a -G git gitlab
</span><span class='line'>sudo usermod -a -G gitlab git
</span><span class='line'><span class="c"># generate key</span>
</span><span class='line'>sudo -H -u gitlab ssh-keygen -q -N ‘’ -t rsa -f /home/gitlab/.ssh/id_rsa
</span><span class='line'><span class="c"># clone gitlab’s fork to the gitolite source code</span>
</span><span class='line'><span class="nb">cd</span> /home/git
</span><span class='line'>sudo -H -u git git clone -b gl-v304 https://github.com/gitlabhq/gitolite.git /home/git/gitolite
</span><span class='line'><span class="c"># setup</span>
</span><span class='line'><span class="nb">cd</span> /home/git
</span><span class='line'>sudo -u git -H mkdir bin
</span><span class='line'>sudo -u git sh -c ‘echo -e “PATH<span class="o">=</span><span class="nv">$PATH</span>:/home/git/bin<span class="se">\n</span>export PATH” » /home/git/.profile’
</span><span class='line'>sudo -u git sh -c ‘gitolite/install -ln /home/git/bin’
</span><span class='line'>sudo cp /home/gitlab/.ssh/id_rsa.pub /home/git/gitlab.pub
</span><span class='line'>sudo chmod 0444 /home/git/gitlab.pub
</span><span class='line'>sudo -u git -H sh -c “PATH<span class="o">=</span>/home/git/bin:<span class="nv">$PATH</span>; gitolite setup -pk /home/git/gitlab.pub”
</span><span class='line'><span class="c"># permissions</span>
</span><span class='line'>sudo chmod -R g+rwX /home/git/repositories/
</span><span class='line'>sudo chown -R git:git /home/git/repositories/
</span><span class='line'>sudo -u gitlab -H git clone git@localhost:gitolite-admin.git /tmp/gitolite-admin&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[[</span> <span class="nv">$?</span> !<span class="o">=</span> 0 <span class="o">]]</span>;<span class="k">then</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> “error: gitolite is not installed correct, or the ssh key is not right”
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;sudo rm -rf /tmp/gitolite-admin
</span><span class='line'><span class="c"># clone gitlab source and install prerequisites</span>
</span><span class='line'>sudo gem install charlock_holmes
</span><span class='line'>sudo pip install pygments
</span><span class='line'><span class="nb">cd</span> /home/gitlab
</span><span class='line'>sudo -H -u gitlab git clone git://github.com/51fanli/gitlabhq.git gitlab
</span><span class='line'><span class="nb">cd </span>gitlab
</span><span class='line'>sudo -u gitlab cp config/gitlab.yml.example config/gitlab.yml
</span><span class='line'><span class="c"># mysql databases init</span>
</span><span class='line'><span class="nb">echo</span> “connect to mysql”
</span><span class='line'>mysql -h127.0.0.1 -uroot -p
</span><span class='line'><span class="c"># CREATE DATABASE IF NOT EXISTS &lt;code&gt;gitlabhq_production&lt;/code&gt; DEFAULT CHARACTER SET &lt;code&gt;utf8&lt;/code&gt; COLLATE &lt;code&gt;utf8_unicode_ci&lt;/code&gt;;</span>
</span><span class='line'><span class="c"># CREATE USER ‘gitlab’@’localhost’ IDENTIFIED BY ‘123456’;</span>
</span><span class='line'><span class="c"># GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, INDEX, ALTER ON &lt;code&gt;gitlabhq_production&lt;/code&gt;.* TO ‘gitlab’@’localhost’;</span>
</span><span class='line'>sudo -u gitlab cp config/database.yml.example config/database.yml
</span><span class='line'>sudo -u gitlab -H bundle install –without development <span class="nb">test </span>sqlite postgres –deployment
</span><span class='line'>sudo -u gitlab -H git config –global user.email “gitlab@localhost”
</span><span class='line'>sudo -u gitlab -H git config –global user.name “Gitlab”
</span><span class='line'>sudo -u gitlab cp config/resque.yml.example config/resque.yml
</span><span class='line'>sudo -u gitlab cp config/unicorn.rb.example config/unicorn.rb
</span><span class='line'><span class="c"># init tables</span>
</span><span class='line'>sudo -u gitlab bundle <span class="nb">exec </span>rake gitlab:app:setup <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span><span class='line'>sudo cp ./lib/hooks/post-receive /home/git/.gitolite/hooks/common/post-receive
</span><span class='line'>sudo chown git:git /home/git/.gitolite/hooks/common/post-receive
</span><span class='line'><span class="c"># check status</span>
</span><span class='line'>sudo -u gitlab bundle <span class="nb">exec </span>rake gitlab:app:status <span class="nv">RAILS_ENV</span><span class="o">=</span>production
</span><span class='line'>sudo wget https://raw.github.com/gitlabhq/gitlab-recipes/master/init.d/gitlab -P /etc/init.d/
</span><span class='line'>sudo chmod +x /etc/init.d/gitlab
</span><span class='line'>sudo update-rc.d gitlab defaults 21
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>gitlabhq3.0后改用unicorn(紧跟github步伐)作为默认的启动server,要将它与nginx或apache一起使用请参考<a href="https://wiki.archlinux.org/index.php/Gitlab#Web_server_configuration">archwiki的gitlab手册</a>,下面是apache中的vhost配置(需要预先编译proxy模块)</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>apache vhost配置  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&amp;lt;VirtualHost *:80&amp;gt;
</span><span class='line'>  ServerName gitlab.myserver.com
</span><span class='line'>  ServerAlias www.gitlab.myserver.com
</span><span class='line'>  DocumentRoot /home/gitlab/gitlab/public
</span><span class='line'>  ErrorLog /var/log/httpd/gitlab_error_log
</span><span class='line'>  CustomLog /var/log/httpd/gitlab_access_log combined&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&amp;lt;Proxy balancer://unicornservers&amp;gt;
</span><span class='line'>      BalancerMember http://127.0.0.1:8080
</span><span class='line'>  &amp;lt;/Proxy&amp;gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&amp;lt;Directory /home/gitlab/gitlab/public&amp;gt;
</span><span class='line'>    AllowOverride All
</span><span class='line'>    Options -MultiViews
</span><span class='line'>  &amp;lt;/Directory&amp;gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;RewriteEngine on
</span><span class='line'>  RewriteCond %<span class="o">{</span>DOCUMENT_ROOT<span class="o">}</span>/%<span class="o">{</span>REQUEST_FILENAME<span class="o">}</span> !-f
</span><span class='line'>  RewriteRule ^/<span class="o">(</span>.*<span class="o">)</span><span class="nv">$ </span>balancer://unicornservers%<span class="o">{</span>REQUEST_URI<span class="o">}</span> <span class="o">[</span>P,QSA,L<span class="o">]</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ProxyPass /uploads !
</span><span class='line'>  ProxyPass / balancer://unicornservers/
</span><span class='line'>  ProxyPassReverse / balancer://unicornservers/
</span><span class='line'>  ProxyPreserveHost on&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&amp;lt;Proxy *&amp;gt;
</span><span class='line'>      Order deny,allow
</span><span class='line'>      Allow from all
</span><span class='line'>   &amp;lt;/Proxy&amp;gt;
</span><span class='line'>&amp;lt;/VirtualHost&amp;gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>unicorn的配置文件在config/unicorn.rb，修改其中的 <code>listen="127.0.0.1:8080"</code>，然后重启apache，通过 <code>service gitlab start</code> 重启unicorn，访问一下gitlab.myserver.com吧，看到登录页面就说明大功告成啦。</p>

<h2 id="qa">Q&amp;A</h2>
<p>### Q: 在装完gitolite后尝试<code>git clone git@localhost:gitolite-admin.git /tmp/gitolite-admin</code>遇到’remote hang-up unexpected’(貌似是这么写，意会。。。)
A: 我在centos6.2上遇到过这个问题，其他发行版上不知道有没有这个问题，修改</p>

<p><code>sudo chmod 400 /home/git/.ssh/authorized_keys</code></p>

<p>可以修复这个问题。貌似是centos的安全策略造成ssh私钥不生效</p>

<h2 id="section">参考资料</h2>
<ul>
  <li><a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">gitlab安装手册官方版</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Gitlab">gitlab手册archwiki版</a></li>
</ul>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[体验gollum]]></title>
    <link href="http://sailxjx.github.io/blog/blog/2012/07/12/ti-yan-gollum/"/>
    <updated>2012-07-12T18:07:00+08:00</updated>
    <id>http://sailxjx.github.io/blog/blog/2012/07/12/ti-yan-gollum</id>
    <content type="html"><![CDATA[<p>gollum是一个轻量级的wiki系统，使用git作为版本管理和跟踪工具，支持markdown，mediawiki，texttile等多种语法，由github开发并且已经投入到githubwiki的应用中。</p>

<ul>
  <li><a href="#gollum_install">安装</a></li>
  <li><a href="#gollum_deploy">部署</a></li>
  <li><a href="#gollum_bug">已发现的bug</a></li>
  <li><a href="#gollum_refer">参考资料</a></li>
</ul>

<h2 id="gollum_install">安装</h2>

<p>gollum与指环王中某个屌丝同名，不知道开发人员的命名灵感是不是来自那里，我们知道，程序员老是喜欢用一些稀奇古怪的东西来给自己的软件命名，像python（莽蛇），octopress（章鱼）等等，搞得好像人人都是动物保护主义者一样～</p>

<p>根据<a href="https://github.com/github/gollum">github主页</a>的说明，gollum的安装非常简单，一条命令解决</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>安装gollum  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="o">[</span>sudo<span class="o">]</span> gem install gollum
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>假如你喜欢追新，觉得这样安装的版本太老，想直接上HEAD的话，clone一个镜像使用<code>bundle install</code>安装好依赖之后，其bin文件夹下面的gollum就直接可以执行了，绝对绿色环保无污染。</p>

<p>现在就来体验一下gollum带来的不同与其他wiki的小清新感觉吧，在主目录下使用以下命令</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>执行gollum  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir gowiki
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>gowiki
</span><span class='line'><span class="nv">$ </span>git init
</span><span class='line'><span class="nv">$ </span>gollum
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><a href="/u/image/gollum-exec-info.png"><img class="right" src="/u/image/gollum-exec-info.png" width="450" height="70" title="“gollum-exec-info”" ></a>
看到右图就说明gollum已经正确的运行了，gollum默认监听4567端口，并且提供了一个可交互的前端，这个时候用户可以通过浏览器打开<a href="http://localhost:4567">http://localhost:4567</a>来看一下gollum了</p>

<p><a href="/u/image/gollum-frontend.png"><img class="right" src="/u/image/gollum-frontend.png" width="450" height="115" title="“gollum-frontend”" ></a></p>

<p>界面实在是足够简洁，提供的几个button实现了wiki的基本功能增删改查，还能查看历史页面，而且还有一套开放的用户系统，name和email由git的使用者决定，头像则由gravatar生成。</p>

<p>除了通过页面编辑wiki以外，gollum还支持直接由git提交版本来更新页面。由于我们gollum默认读取master分支，而我们正checkout在master上，不方便其他人的编辑，所以我们暂时新建一个demo分支来避免冲突。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>用git来写wiki  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git branch demo
</span><span class='line'><span class="nv">$ </span>git checkout demo
</span><span class='line'><span class="nv">$ </span>mkdir ../gowiki2 &amp;amp;&amp;amp; <span class="nb">cd</span> ../gowiki2
</span><span class='line'><span class="nv">$ </span>git init &amp;amp;&amp;amp; git remote add origin ../gowiki
</span><span class='line'><span class="nv">$ </span>git pull
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>现在gowiki2中应该有了之前编辑过的几个页面，修改以后push到origin的master，就可以在wiki中看到刚刚的更新了。</p>

<!--more-->

<h2 id="gollum_deploy">部署</h2>

<p>虽然gollum提供了一个命令行工具监听端口来提供web服务，但是没有daemon选项，也没有容错机制，何况想来也没有多少人会使用4567端口来访问webserver。那有没有办法将gollum托管给我们的web服务器呢，答案是肯定的，下面以apache为例。</p>

<p>gollum由ruby写成，所以首先需要安装<a href="http://www.modrails.com">passenger(mod_rails)</a>模块，这个模块的安装在<a href="http://www.modrails.com/install.html">官网</a>上有详细的介绍，与其他apache模块的安装大同小异，下面主要介绍一下vhost的配置。</p>

<p>首先进入gollum的安装路径，不知道的可以用下面的命令找一下
<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>查找gollum路径  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>gem which gollum
</span><span class='line'>/usr/local/ruby/lib/ruby/gems/1.9.1/gems/gollum-2.0.0/lib/gollum.rb
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>gollum的前端app在gollum/frontend/public/下(将这个uri跟在上面找出来的路径下就行了)，下面将用<code>frontpath=/usr/local/ruby/lib/ruby/gems/1.9.1/gems/gollum-2.0.0/lib/gollum/frontend/</code>来替代，然后配置vhost</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>apache的virtual-hosts配置  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&amp;lt;VirtualHost *&amp;gt;
</span><span class='line'>    ServerName www.gollum.local.com  <span class="c">#替换成自己的域名</span>
</span><span class='line'>    DocumentRoot <span class="k">${</span><span class="nv">frontpath</span><span class="k">}</span>public/ <span class="c">#替换成本地路径</span>
</span><span class='line'>&amp;lt;/VirtualHost&amp;gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>然后在${frontpath}(同上，真实路径)下新建一个文件config.ru，写入下面的内容</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>config.ru  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/local/bin/env ruby</span>
</span><span class='line'><span class="nb">require</span> <span class="err">‘</span><span class="n">rubygems</span><span class="err">’</span>
</span><span class='line'><span class="nb">require</span> <span class="err">‘</span><span class="n">gollum</span><span class="o">/</span><span class="n">frontend</span><span class="o">/</span><span class="n">app</span><span class="err">’</span>
</span><span class='line'><span class="nb">system</span><span class="p">(</span><span class="err">“</span><span class="n">which</span> <span class="n">git</span><span class="err">”</span><span class="p">)</span> <span class="ow">or</span> <span class="k">raise</span> <span class="err">“</span><span class="no">Looks</span> <span class="n">like</span> <span class="n">I</span> <span class="n">can</span><span class="err">’</span><span class="n">t</span> <span class="n">find</span> <span class="n">the</span> <span class="n">git</span> <span class="no">CLI</span> <span class="k">in</span> <span class="n">your</span> <span class="n">path</span><span class="o">.</span><span class="p">\</span><span class="n">nYour</span> <span class="n">path</span> <span class="n">is</span><span class="p">:</span> <span class="c1">#{ENV[‘PATH’]}”</span>
</span><span class='line'><span class="n">gollum_path</span> <span class="o">=</span> <span class="err">‘</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="p">{</span><span class="n">user</span><span class="p">}</span><span class="o">/</span><span class="n">gowiki</span><span class="err">’</span> <span class="c1">#这里的路径替换成实际想存放wiki文档的git目录</span>
</span><span class='line'><span class="n">disable</span> <span class="ss">:run</span>
</span><span class='line'><span class="n">configure</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:staging</span><span class="p">,</span> <span class="ss">:production</span> <span class="k">do</span>
</span><span class='line'> <span class="n">set</span> <span class="ss">:raise_errors</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'> <span class="n">set</span> <span class="ss">:show_exceptions</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'> <span class="n">set</span> <span class="ss">:dump_errors</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'> <span class="n">set</span> <span class="ss">:clean_trace</span><span class="p">,</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'><span class="vg">$path</span> <span class="o">=</span> <span class="n">gollum_path</span>
</span><span class='line'><span class="no">Precious</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:gollum_path</span><span class="p">,</span> <span class="n">gollum_path</span><span class="p">)</span>
</span><span class='line'><span class="no">Precious</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:wiki_options</span><span class="p">,</span> <span class="p">{})</span>
</span><span class='line'><span class="n">run</span> <span class="no">Precious</span><span class="o">::</span><span class="no">App</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>为了使/home/{user}/gowiki目录具有写权限，可以将这个目录的权限这是设为777或者让passenger进程的用户组设为user，修改httpd.conf增加一行<code>PassengerDefaultUser user</code>，这样我们通过web端更新wiki的时候就不会报权限问题了。</p>

<p>现在重启apache，然后访问www.gollum.local.com，结果就与上面看到的页面一模一样啦～～。</p>

<h2 id="gollum_bug">已发现的bug</h2>

<p>gollum绑定的grit库中存在一个关于编码的错误[<a href="https://github.com/github/gollum/issues/147">issue</a>],当提交的文本中包含unicode字符时会导致一个fetal error。在grit2.5.0中修复了这个错误，所以在bundle之前需要先将grit版本设置为2.5.0。gollum最近的两个版本中需要修改的地方还不太一样，晕了～。输入<code>gollum --version</code>看一下版本，假如是2.0.0(gem安装的版本)，则修改gollum.gemspec，若是2.1.0(目前的HEAD版本)，则修改Gemfile.lock。将其中的grit版本改为2.5.0即可。</p>

<h2 id="gollum_refer">参考资料</h2>

<ul>
  <li><a href="https://github.com/github/gollum/blob/master/README.md">README</a></li>
  <li><a href="https://github.com/tecnh/gollum/wiki/Gollum-and-Passenger">Gollum and Passenger</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
